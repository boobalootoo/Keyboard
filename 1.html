<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Keyboard</title>
    <!--
      Load Tailwind CSS from a CDN for utility-first styling.
      This makes the design responsive and modern with minimal custom CSS.
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define the font family for the entire body */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Custom styles for the output strip to ensure it is a thin line at the top */
        #output-strip {
            height: 48px; /* Fixed height for the output strip */
            -ms-overflow-style: none;  /* Hide scrollbar for IE and Edge */
            scrollbar-width: none;  /* Hide scrollbar for Firefox */
        }
        /* Hide scrollbar for Webkit browsers (Chrome, Safari) */
        #output-strip::-webkit-scrollbar {
            display: none;
        }

        /*
          The main keyboard container uses flexbox to wrap content.
          No gap is specified to make the keys flush against each other.
        */
        #keyboard-container {
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start; /* Aligns content at the start to prevent blank space */
            flex-grow: 1;
            overflow-y: auto;
        }

        /*
          Base styles for all keyboard buttons.
          - flex-grow-0 and flex-shrink-0 ensure they don't stretch.
          - dynamic padding based on content.
        */
        .keyboard-btn {
            @apply m-0 rounded-none text-lg md:text-xl font-medium cursor-pointer transition-all duration-200 ease-in-out select-none flex-grow-0 flex-shrink-0
                   shadow-sm hover:shadow-md active:shadow-inner;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            /* Using a box-shadow for a press-down effect */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* Color-coding based on data-type attribute */
        .noun { @apply bg-blue-500 text-white hover:bg-blue-600; }
        .verb { @apply bg-green-500 text-white hover:bg-green-600; }
        .adjective { @apply bg-red-500 text-white hover:bg-red-600; }
        .adverb { @apply bg-yellow-400 text-gray-800 hover:bg-yellow-500; }
        .determiner { @apply bg-orange-400 text-gray-800 hover:bg-orange-500; }
        .preposition { @apply bg-purple-500 text-white hover:bg-purple-600; }
        .conjunction { @apply bg-pink-500 text-white hover:bg-pink-600; }
        .other { @apply bg-gray-200 text-gray-800 hover:bg-gray-300; }
        .action { @apply bg-blue-600 text-white hover:bg-blue-700; }
        .caps-active { @apply bg-orange-400 text-white hover:bg-orange-500; }
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen overflow-hidden">

    <!-- Output strip at the very top. -->
    <div id="output-strip" class="bg-white shadow-md p-3 px-4 text-xl md:text-2xl text-gray-800 overflow-x-auto whitespace-nowrap flex-shrink-0">
        <span id="output-text" class="min-w-full"></span>
    </div>

    <!-- The main keyboard area. The buttons will be dynamically generated here. -->
    <div id="keyboard-container" class="flex-grow"></div>

    <script>
        // Get references to DOM elements
        const outputText = document.getElementById('output-text');
        const keyboardContainer = document.getElementById('keyboard-container');
        const outputStrip = document.getElementById('output-strip');

        // Check for browser support for speech synthesis
        const speechSupported = 'speechSynthesis' in window;
        if (!speechSupported) {
            console.log('Speech Synthesis not supported in this browser.');
        }

        // State variables
        let isCapsOn = false;

        // Map word types to Tailwind CSS classes
        const typeClasses = {
            'noun': 'noun',
            'verb': 'verb',
            'adjective': 'adjective',
            'adverb': 'adverb',
            'determiner': 'determiner',
            'preposition': 'preposition',
            'conjunction': 'conjunction',
            'other': 'other',
            'action': 'action',
        };

        // --- LOCAL WORD DATABASE ---
        // This object stores the predictive words.
        // The keys are the preceding words, and the values are the lists of suggested next words.
        const wordDatabase = {
            'start': [
                { word: "The", type: "determiner" },
                { word: "A", type: "determiner" },
                { word: "I", type: "other" },
                { word: "You", type: "other" },
                { word: "My", type: "determiner" },
                { word: "This", type: "determiner" },
                { word: "We", type: "other" },
                { word: "He", type: "other" },
                { word: "She", type: "other" },
                { word: "They", type: "other" },
                { word: "It", type: "other" },
                { word: "It's", type: "other" },
                { word: "go", type: "verb" },
                { word: "run", type: "verb" },
                { word: "eat", type: "verb" },
                { word: "look", type: "verb" },
                { word: "hello", type: "other" },
                { word: "goodbye", type: "other" },
                { word: "happy", type: "adjective" },
                { word: "sad", type: "adjective" },
                { word: "big", type: "adjective" },
                { word: "small", type: "adjective" },
                { word: "fast", type: "adjective" },
                { word: "quickly", type: "adverb" },
                { word: "slowly", type: "adverb" },
                { word: "in", type: "preposition" },
                { word: "on", type: "preposition" },
                { word: "and", type: "conjunction" },
                { word: "but", type: "conjunction" },
                { word: "so", type: "conjunction" },
            ],
            'I': [
                { word: "am", type: "verb" },
                { word: "am not", type: "verb" },
                { word: "have", type: "verb" },
                { word: "want", type: "verb" },
                { word: "like", type: "verb" },
                { word: "go", type: "verb" },
                { word: "need", type: "verb" },
                { word: "can", type: "verb" },
                { word: "will", type: "verb" },
                { word: "think", type: "verb" },
                { word: "believe", type: "verb" },
            ],
            'The': [
                { word: "cat", type: "noun" },
                { word: "dog", type: "noun" },
                { word: "house", type: "noun" },
                { word: "sun", type: "noun" },
                { word: "moon", type: "noun" },
                { word: "car", type: "noun" },
                { word: "city", type: "noun" },
                { word: "story", type: "noun" },
                { word: "end", type: "noun" },
                { word: "beginning", type: "noun" },
            ],
            'a': [
                { word: "big", type: "adjective" },
                { word: "small", type: "adjective" },
                { word: "red", type: "adjective" },
                { word: "blue", type: "adjective" },
                { word: "green", type: "adjective" },
                { word: "new", type: "adjective" },
                { word: "tall", type: "adjective" },
                { word: "short", type: "adjective" },
                { word: "happy", type: "adjective" },
                { word: "sad", type: "adjective" },
                { word: "person", type: "noun" },
                { word: "dog", type: "noun" },
                { word: "cat", type: "noun" },
            ],
            'car': [
                { word: "is", type: "verb" },
                { word: "was", type: "verb" },
                { word: "had", type: "verb" },
                { word: "runs", type: "verb" },
                { word: "drives", type: "verb" },
                { word: "of", type: "preposition" },
                { word: "in", type: "preposition" },
            ],
            'is': [
                { word: "a", type: "determiner" },
                { word: "the", type: "determiner" },
                { word: "very", type: "adverb" },
                { word: "not", type: "adverb" },
                { word: "good", type: "adjective" },
                { word: "happy", type: "adjective" },
                { word: "sad", type: "adjective" },
            ],
            'happy': [
                { word: "person", type: "noun" },
                { word: "dog", type: "noun" },
                { word: "cat", type: "noun" },
                { word: "and", type: "conjunction" },
                { word: "but", type: "conjunction" },
            ],
            'run': [
                { word: "quickly", type: "adverb" },
                { word: "slowly", type: "adverb" },
                { word: "fast", type: "adjective" },
                { word: "to", type: "preposition" },
                { word: "away", type: "adverb" },
            ],
            'in': [
                { word: "the", type: "determiner" },
                { word: "a", type: "determiner" },
                { word: "my", type: "determiner" },
                { word: "that", type: "determiner" },
                { word: "this", type: "determiner" },
            ],
            'on': [
                { word: "the", type: "determiner" },
                { word: "a", type: "determiner" },
                { word: "my", type: "determiner" },
                { word: "that", type: "determiner" },
                { word: "this", type: "determiner" },
            ],
            'and': [
                { word: "then", type: "adverb" },
                { word: "go", type: "verb" },
                { word: "run", type: "verb" },
                { word: "a", type: "determiner" },
                { word: "the", type: "determiner" },
                { word: "I", type: "other" },
                { word: "he", type: "other" },
                { word: "she", type: "other" },
            ],
            'not': [
                { word: "go", type: "verb" },
                { word: "run", type: "verb" },
                { word: "eat", type: "verb" },
                { word: "like", type: "verb" },
            ],
            'so': [
                { word: "I", type: "other" },
                { word: "he", type: "other" },
                { word: "she", type: "other" },
                { word: "it", type: "other" },
            ],
            'house': [
                { word: "is", type: "verb" },
                { word: "was", type: "verb" },
                { word: "had", type: "verb" },
                { word: "and", type: "conjunction" },
                { word: "in", type: "preposition" },
                { word: "with", type: "preposition" },
            ],
            'person': [
                { word: "is", type: "verb" },
                { word: "was", type: "verb" },
                { word: "had", type: "verb" },
                { word: "runs", type: "verb" },
                { word: "and", type: "conjunction" },
            ],
            'dog': [
                { word: "is", type: "verb" },
                { word: "was", type: "verb" },
                { word: "had", type: "verb" },
                { word: "runs", type: "verb" },
                { word: "and", type: "conjunction" },
                { word: "in", type: "preposition" },
                { word: "with", type: "preposition" },
            ],
            // Punctuation keys to add a new sentence
            '.': [{ word: "I", type: "other" }, { word: "The", type: "determiner" }, { word: "We", type: "other" }],
            '?': [{ word: "I", type: "other" }, { word: "The", type: "determiner" }, { word: "We", type: "other" }],
            '!': [{ word: "I", type: "other" }, { word: "The", type: "determiner" }, { word: "We", type: "other" }],
            // Fallback set of words
            '_fallback_': [
                { word: "The", type: "determiner" },
                { word: "a", type: "determiner" },
                { word: "I", type: "other" },
                { word: "you", type: "other" },
                { word: "run", type: "verb" },
                { word: "go", type: "verb" },
                { word: "eat", type: "verb" },
                { word: "walk", type: "verb" },
                { word: "car", type: "noun" },
                { word: "house", type: "noun" },
                { word: "time", type: "noun" },
                { word: "dog", type: "noun" },
                { word: "happy", type: "adjective" },
                { word: "big", type: "adjective" },
                { word: "small", type: "adjective" },
                { word: "sad", type: "adjective" },
                { word: "in", type: "preposition" },
                { word: "on", type: "preposition" },
                { word: "with", type: "preposition" },
                { word: "and", type: "conjunction" },
                { word: "but", type: "conjunction" },
            ],
        };

        const staticButtons = [
            { word: ".", type: "other", isPunctuation: true },
            { word: ",", type: "other", isPunctuation: true },
            { word: "?", type: "other", isPunctuation: true },
            { word: "!", type: "other", isPunctuation: true },
            { word: "Caps", type: "action", action: "caps" },
            { word: "Space", type: "action", action: "space" },
            { word: "Backspace", type: "action", action: "backspace" },
            { word: "Clear All", type: "action", action: "clear" },
        ];


        /**
         * Renders the keyboard buttons based on a list of words.
         * @param {Array<Object>} words - An array of word objects with 'word' and 'type' properties.
         */
        function renderKeyboard(words) {
            // Clear existing buttons
            keyboardContainer.innerHTML = '';

            // Add new word buttons from the provided list
            words.forEach(wordData => {
                const button = document.createElement('button');
                button.textContent = wordData.word;
                button.className = `keyboard-btn ${typeClasses[wordData.type] || 'other'}`;
                button.dataset.word = wordData.word;
                button.dataset.type = wordData.type;
                if (wordData.isPunctuation) {
                    button.dataset.isPunctuation = 'true';
                }
                keyboardContainer.appendChild(button);
            });

            // Add static action buttons at the end
            staticButtons.forEach(buttonData => {
                const button = document.createElement('button');
                button.textContent = buttonData.word;
                button.className = `keyboard-btn ${typeClasses[buttonData.type]}`;
                button.dataset.word = buttonData.word;
                button.dataset.type = buttonData.type;
                if (buttonData.isPunctuation) {
                    button.dataset.isPunctuation = 'true';
                }
                if (buttonData.action) {
                    button.dataset.action = buttonData.action;
                }
                keyboardContainer.appendChild(button);
            });
        }

        /**
         * Looks up predictive words from the local database.
         * @param {string} lastWord - The last word typed by the user.
         */
        function getPredictiveWords(lastWord) {
            // Normalize the word to lowercase for consistent lookup
            const normalizedWord = lastWord.toLowerCase().trim();
            // Get the list of words from the database, or fall back to the default
            const nextWords = wordDatabase[normalizedWord] || wordDatabase['_fallback_'];
            // Render the keyboard with the new words
            renderKeyboard(nextWords);
        }

        // Add a click listener to the entire keyboard container
        keyboardContainer.addEventListener('click', (event) => {
            const clickedButton = event.target.closest('.keyboard-btn');
            if (!clickedButton) return;

            const action = clickedButton.dataset.action;
            let word = clickedButton.dataset.word;
            const isPunctuation = clickedButton.dataset.isPunctuation;

            // Handle actions first
            if (action === 'caps') {
                isCapsOn = !isCapsOn;
                clickedButton.classList.toggle('caps-active', isCapsOn);
                return;
            } else if (action === 'space') {
                outputText.textContent += ' ';
            } else if (action === 'backspace') {
                let currentText = outputText.textContent;
                const lastSpaceIndex = currentText.trimEnd().lastIndexOf(' ');
                if (lastSpaceIndex !== -1) {
                    outputText.textContent = currentText.substring(0, lastSpaceIndex + 1);
                } else {
                    outputText.textContent = '';
                }
                const newLastWord = outputText.textContent.trim().split(' ').pop() || 'start';
                getPredictiveWords(newLastWord);
            } else if (action === 'clear') {
                outputText.textContent = '';
                getPredictiveWords('start'); // Reset the keyboard to the initial state
            } else if (word) {
                // Handle word input
                if (isCapsOn) {
                    word = word.charAt(0).toUpperCase() + word.slice(1);
                    isCapsOn = false;
                    const capsButton = document.querySelector('[data-action="caps"]');
                    if (capsButton) capsButton.classList.remove('caps-active');
                }

                if (isPunctuation) {
                    outputText.textContent = outputText.textContent.trimEnd() + word;
                } else {
                    outputText.textContent += word;
                }

                // Add space if not punctuation
                if (!isPunctuation) {
                    outputText.textContent += ' ';
                }

                // Speak the word out loud
                if (speechSupported && word.trim() !== '') {
                    const utterance = new SpeechSynthesisUtterance(word.trim());
                    window.speechSynthesis.speak(utterance);
                }

                // Get new predictive words from the local database
                getPredictiveWords(word);
            }

            // Scroll to the end of the output strip
            outputStrip.scrollLeft = outputStrip.scrollWidth;
        });

        // Call the initial render function when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            getPredictiveWords('start');
        });
    </script>
</body>
</html>
